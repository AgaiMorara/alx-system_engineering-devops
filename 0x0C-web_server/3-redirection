#!/usr/bin/env bash
#This script installs nginx
# Install nginx

sudo apt-get update
sudo apt-get -y install nginx
sudo ufw allow 'Nginx HTTP'
# Configure nginx to listen on port 80 and serve "Hello World!" at the root
sudo bash -c 'echo "Hello World!" > /var/www/html/index.html'

CONFIG_FILE="/etc/nginx/sites-available/default"

# Backup the original configuration file
sudo cp "$CONFIG_FILE" "${CONFIG_FILE}.bakup"

# Define the new rule to insert
NEW_RULE="\n\tlocation = /redirect_me {\n\t\treturn 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\t}\n"

# Insert the new rule before the last closing bracket of the first server block
sudo sed -i "/^server\s*{/!b;n;:a;/}/!{N;ba};/}/i$NEW_RULE" "$CONFIG_FILE"


# Reload Nginx to apply the changes if the test is successful
if [ $? -eq 0 ]; then
    sudo service nginx reload
else
    echo "Nginx configuration test failed. Please check the config file."
fi
